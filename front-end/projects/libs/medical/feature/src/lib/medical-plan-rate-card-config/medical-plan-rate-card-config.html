<div class="space-y-4">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h3 class="text-lg font-semibold text-slate-900">Rate Cards</h3>
      <p class="text-sm text-slate-500">Premium rates for this plan</p>
    </div>
    <button mat-flat-button color="primary" (click)="openCreateDialog()">
      <mat-icon fontSet="material-symbols-rounded">add</mat-icon>
      New Rate Card
    </button>
  </div>

  <!-- Loading -->
  @if (store.isLoading()) {
  <div class="flex items-center justify-center py-12">
    <mat-spinner diameter="32"></mat-spinner>
  </div>
  } @else {
  <!-- Active Rate Card Highlight -->
  @if (activeRateCard(); as active) {
  <div class="rounded-xl border-2 border-green-200 bg-green-50 p-4">
    <div class="flex items-start justify-between">
      <div class="flex items-center gap-3">
        <div class="flex h-10 w-10 items-center justify-center rounded-full bg-green-100">
          <mat-icon fontSet="material-symbols-rounded" class="!text-green-600"
            >check_circle</mat-icon
          >
        </div>
        <div>
          <div class="flex items-center gap-2">
            <span class="font-semibold text-green-900">{{ active.name }}</span>
            <span class="rounded-full bg-green-200 px-2 py-0.5 text-xs font-medium text-green-800"
              >Active</span
            >
          </div>
          <p class="text-sm text-green-700">{{ active.code }} • v{{ active.version }}</p>
        </div>
      </div>
      <div class="text-right">
        <p class="text-xs text-green-600">{{ getFrequencyLabel(active.premium_frequency) }}</p>
        <p class="text-xs text-green-600">{{ active.entries_count || 0 }} age bands</p>
      </div>
    </div>
  </div>
  }

  <!-- Rate Cards List -->
  @if (rateCards().length > 0) {
  <div class="space-y-3">
    @for (rc of rateCards(); track rc.id) { @if (!rc.is_active) {
    <div
      class="rounded-xl border border-slate-200 bg-white p-4 hover:border-slate-300 transition-colors"
    >
      <div class="flex items-start justify-between">
        <div class="flex items-center gap-3">
          <div
            class="flex h-10 w-10 items-center justify-center rounded-full"
            [class]="rc.is_draft ? 'bg-amber-100' : 'bg-slate-100'"
          >
            <mat-icon
              fontSet="material-symbols-rounded"
              [class]="rc.is_draft ? '!text-amber-600' : '!text-slate-500'"
            >
              {{ rc.is_draft ? 'edit_note' : 'payments' }}
            </mat-icon>
          </div>
          <div>
            <div class="flex items-center gap-2">
              <span class="font-medium text-slate-900">{{ rc.name }}</span>
              @if (rc.is_draft) {
              <span class="rounded-full bg-amber-100 px-2 py-0.5 text-xs font-medium text-amber-700"
                >Draft</span
              >
              }
            </div>
            <p class="text-sm text-slate-500">{{ rc.code }} • v{{ rc.version }}</p>
          </div>
        </div>

        <div class="flex items-center gap-2">
          <div class="text-right mr-2">
            <p class="text-xs text-slate-500">{{ getFrequencyLabel(rc.premium_frequency) }}</p>
            <p class="text-xs text-slate-400">{{ rc.entries_count || 0 }} entries</p>
          </div>

          <button mat-icon-button [matMenuTriggerFor]="rcMenu" class="!text-slate-400">
            <mat-icon fontSet="material-symbols-rounded">more_vert</mat-icon>
          </button>

          <mat-menu #rcMenu="matMenu">
            <button mat-menu-item (click)="openCreateDialog(rc)">
              <mat-icon fontSet="material-symbols-rounded" class="!text-slate-500">edit</mat-icon>
              <span>Edit</span>
            </button>
            <button mat-menu-item [routerLink]="['/rate-cards', rc.id]">
              <mat-icon fontSet="material-symbols-rounded" class="!text-slate-500"
                >table_chart</mat-icon
              >
              <span>Manage Entries</span>
            </button>
            @if (rc.is_draft) {
            <button mat-menu-item (click)="activateRateCard(rc)">
              <mat-icon fontSet="material-symbols-rounded" class="!text-green-500"
                >check_circle</mat-icon
              >
              <span>Activate</span>
            </button>
            }
            <button mat-menu-item (click)="cloneRateCard(rc)">
              <mat-icon fontSet="material-symbols-rounded" class="!text-slate-500"
                >content_copy</mat-icon
              >
              <span>Clone</span>
            </button>
            <mat-divider></mat-divider>
            <button mat-menu-item class="!text-red-600" (click)="deleteRateCard(rc)">
              <mat-icon fontSet="material-symbols-rounded" class="!text-red-500">delete</mat-icon>
              <span>Delete</span>
            </button>
          </mat-menu>
        </div>
      </div>
    </div>
    } }
  </div>
  } @else {
  <!-- Empty State -->
  <div class="rounded-xl border border-dashed border-slate-300 bg-slate-50 p-8 text-center">
    <div class="flex h-12 w-12 items-center justify-center rounded-full bg-slate-100 mx-auto mb-4">
      <mat-icon fontSet="material-symbols-rounded" class="!text-slate-400">payments</mat-icon>
    </div>
    <h4 class="text-sm font-medium text-slate-900">No Rate Cards</h4>
    <p class="text-sm text-slate-500 mt-1 max-w-sm mx-auto">
      Create a rate card to define premium rates by age bands for this plan.
    </p>
    <button mat-flat-button color="primary" class="mt-4" (click)="openCreateDialog()">
      <mat-icon fontSet="material-symbols-rounded">add</mat-icon>
      Create Rate Card
    </button>
  </div>
  } }
</div>
