@if (store.isLoading()) { @for (i of [1,2,3,4,5]; track i) {
<div class="flex gap-4 p-4 border-b border-slate-100">
  <lib-skeleton classes="h-10 w-10 rounded-full" />
  <div class="flex-1 space-y-2">
    <lib-skeleton classes="h-4 w-1/3" /> <lib-skeleton classes="h-3 w-1/2" />
  </div>
  <lib-skeleton classes="h-8 w-20 rounded-lg" />
</div>
} }@else {

<div class="p-4 sm:p-8 bg-gray-50 min-h-screen">
  <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-8 gap-4">
    <div>
      <h1 class="text-2xl sm:text-3xl font-bold text-slate-800 tracking-tight">Medical Schemes</h1>
      <p class="text-slate-500 text-sm sm:text-base">
        Manage umbrella products and organizational tiers
      </p>
    </div>
    <button
      mat-flat-button
      color="primary"
      class="w-full sm:w-auto rounded-lg py-6"
      (click)="openCreateModal()"
    >
      <mat-icon class="mr-2">add</mat-icon> Create New Scheme
    </button>
  </div>

  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-8">
    <div class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
      <span class="text-slate-500 text-sm font-medium uppercase tracking-wider">Total Schemes</span>
      <div class="text-3xl font-bold text-slate-900 mt-1">{{ store.schemes().length }}</div>
    </div>
  </div>

  <div
    class="bg-white rounded-xl shadow-sm overflow-hidden border border-slate-200 overflow-x-auto"
  >
    <table mat-table [dataSource]="store.schemes()" class="w-full min-w-[600px]">
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef class="bg-slate-50 px-4">Status</th>
        <td mat-cell *matCellDef="let scheme" class="px-4">
          <span
            [class]="scheme.is_active ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-700'"
            class="px-3 py-1 rounded-full text-xs font-bold uppercase tracking-tighter"
          >
            {{ scheme.is_active ? 'Active' : 'Inactive' }}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef class="bg-slate-50 px-4">Scheme Details</th>
        <td mat-cell *matCellDef="let scheme" class="py-4 px-4">
          <div class="font-bold text-slate-800">{{ scheme.name }}</div>
          <div class="text-xs text-slate-500 truncate max-w-[200px]">{{ scheme.description }}</div>
        </td>
      </ng-container>

      <ng-container matColumnDef="plans">
        <th mat-header-cell *matHeaderCellDef class="bg-slate-50 text-center px-4">Linked Plans</th>
        <td mat-cell *matCellDef="let scheme" class="text-center px-4">
          <span class="bg-blue-50 text-blue-700 px-3 py-1 rounded-lg font-bold text-xs uppercase">
            {{ scheme.plan_count || 0 }} Plans
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="bg-slate-50 text-right pr-6"></th>
        <td mat-cell *matCellDef="let scheme" class="text-right pr-6">
          <button mat-icon-button [matMenuTriggerFor]="menu" class="text-slate-400">
            <mat-icon>more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)="openCreateModal(scheme)">
              <mat-icon>edit</mat-icon><span>Edit</span>
            </button>
            <button mat-menu-item (click)="toggleStatus(scheme)">
              <mat-icon>{{ scheme.is_active ? 'block' : 'check_circle' }}</mat-icon>
              <span>{{ scheme.is_active ? 'Deactivate' : 'Activate' }}</span>
            </button>
            <button mat-menu-item class="text-red-600" (click)="deleteScheme(scheme.id)">
              <mat-icon class="text-red-600">delete</mat-icon><span>Delete</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        class="hover:bg-slate-50 transition-colors"
      ></tr>
    </table>

    @if (store.isLoading()) {
    <div class="p-8 text-center text-slate-500 animate-pulse">Loading schemes...</div>
    } @else if (store.schemes().length === 0) {
    <div class="p-12 text-center text-slate-500 italic">No medical schemes found.</div>
    }
  </div>
</div>
}
